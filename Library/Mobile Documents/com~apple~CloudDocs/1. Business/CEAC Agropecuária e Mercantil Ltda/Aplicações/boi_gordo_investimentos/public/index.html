<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACEX Capital Markets - Plataforma Profissional</title>
    
    <!-- META TAGS PARA FORÇAR ATUALIZAÇÃO - CACHE BUSTER -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="cache-buster" content="20250719-acex-<?= time() ?>">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Font Awesome - Versão atualizada -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- CSS Principal -->
    <link rel="stylesheet" href="css/styles.css?v=inter-compacto-icones-corrigidos-20250119">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- D3.js para Treemap -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header Principal -->
        <header class="main-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="logo-text">
                        ACEX Capital Markets
                    </div>
                </div>
                

                
                <div class="header-actions">
                    <button class="btn btn-icon mobile-sidebar-toggle" onclick="toggleMobileSidebar()" title="Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <button class="btn btn-outline-primary" onclick="abrirModal('modal-nova-transacao')">
                        <i class="fas fa-plus"></i>
                        Nova Transação
                    </button>
                    <button class="btn btn-secondary" onclick="exportarDados()">
                        <i class="fas fa-download"></i>
                        Exportar
                    </button>
                </div>
            </div>
        </header>

                <!-- Container Principal (Sidebar + Conteúdo) -->
        <div class="main-container">
            <!-- Sidebar Lateral -->
            <aside class="sidebar">
                <nav class="sidebar-nav">
                    <ul class="sidebar-menu">
                        <li class="sidebar-item active">
                            <a class="sidebar-link" data-tab="resumo">
                                <i class="sidebar-icon fas fa-chart-pie"></i>
                                <span class="sidebar-text">Resumo</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" data-tab="rentabilidade">
                                <i class="sidebar-icon fas fa-chart-line"></i>
                                <span class="sidebar-text">Rentabilidade</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" data-tab="posicoes">
                                <i class="sidebar-icon fas fa-briefcase"></i>
                                <span class="sidebar-text">Posições</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" data-tab="transacoes">
                                <i class="sidebar-icon fas fa-exchange-alt"></i>
                                <span class="sidebar-text">Transações</span>
                            </a>
                        </li>
                        <li class="sidebar-item">
                            <a class="sidebar-link" data-tab="configuracoes">
                                <i class="sidebar-icon fas fa-cog"></i>
                                <span class="sidebar-text">Configurações</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Rodapé da Sidebar -->
                <div class="sidebar-footer">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span>Usuário</span>
                    </div>
                </div>
            </aside>

            <!-- Conteúdo Principal -->
            <main class="main-content">
            <!-- Aba Resumo -->
            <div id="tab-resumo" class="tab-content active">
                <!-- Layout Principal do Resumo -->
                <div class="resumo-layout">
                    <!-- Card Principal de Contratos -->
                    <div class="patrimonio-card">
                        <div class="patrimonio-header">
                            <h3>Posições em Aberto</h3>
                            <div class="patrimonio-icon">
                                <i class="fas fa-file-contract"></i>
                            </div>
                        </div>
                        <div class="patrimonio-value">
                            <span id="contratos-aberto" class="valor-principal">45</span><span class="valor-prefixo">x</span>
                            <span class="valor-secundario"><span id="total-long">28</span> Long | <span id="total-short">17</span> Short</span>
                        </div>
                        <div class="patrimonio-detalhes">
                            <!-- Posições por Referência -->
                            <div class="detalhe-secao">
                                <div class="secao-titulo">Posições por Referência</div>
                                <div class="detalhe-item">
                                    <span class="detalhe-label">BGI - Boi Gordo:</span>
                                    <div class="valor-unidade">
                                        <div class="valor-com-prefixo">
                                            <span id="total-bgi-contratos" class="detalhe-valor">28</span><span class="valor-prefixo verde">x</span>
                                        </div>
                                        <span class="posicoes-info"><span id="bgi-long-total">18</span> Long | <span id="bgi-short-total">10</span> Short</span>
                                    </div>
                                </div>
                                <div class="detalhe-item">
                                    <span class="detalhe-label">CCM - Milho:</span>
                                    <div class="valor-unidade">
                                        <div class="valor-com-prefixo">
                                            <span id="total-ccm-contratos" class="detalhe-valor">17</span><span class="valor-prefixo verde">x</span>
                                        </div>
                                        <span class="posicoes-info"><span id="ccm-long-total">12</span> Long | <span id="ccm-short-total">5</span> Short</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Gráfico de Posições em Aberto por Sentido -->
                            <div class="detalhe-secao">
                                <div class="secao-titulo">Posições em Aberto por Sentido</div>
                                <div class="chart-container small">
                                    <canvas id="chart-precos-sentido"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gráfico de Análise de Posições -->
                    <div class="evolucao-card">
                        <div class="card-header">
                            <h4 class="card-title">Análise de Exposição por Sentido</h4>
                            <div class="periodo-toggle">
                                <button class="btn btn-sm active" onclick="alterarModoAnalise('quantidade')" id="btn-quantidade">Volume</button>
                                <button class="btn btn-sm" onclick="alterarModoAnalise('preco')" id="btn-preco">Preço/Arroba</button>
                                <button class="btn btn-sm" onclick="alterarModoAnalise('resultado')" id="btn-resultado">Resultado</button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="chart-analise-posicoes"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Seção de Gráficos Analíticos -->
                <div class="analytics-section">
                    <!-- Gráfico de Posições por Referência -->
                    <div class="content-card">
                        <div class="card-header">
                            <h4 class="card-title">Posições por Referência</h4>
                            <p class="card-subtitle">Distribuição de contratos entre Boi Gordo e Milho</p>
                        </div>
                        <div class="card-body">
                            <div class="chart-container small">
                                <canvas id="chart-ativos-referencia"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Gráfico de Preços dos Contratos -->
                    <div class="content-card">
                        <div class="card-header">
                            <h4 class="card-title">Preços Médios por Contrato</h4>
                            <p class="card-subtitle">Preços Long/Short de todos os vencimentos ativos</p>
                        </div>
                        <div class="card-body">
                            <div class="chart-container small">
                                <canvas id="chart-preco-medio"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabela de Últimas Movimentações -->
                <div class="content-card">
                    <div class="card-header">
                        <h4 class="card-title">Últimas Movimentações</h4>
                        <button class="btn btn-outline-primary btn-sm" onclick="mostrarTab('transacoes')">
                            Ver todas
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="professional-table" id="tabela-ultimas-movimentacoes">
                                <thead>
                                    <tr>
                                        <th>Ativo</th>
                                        <th>Tipo</th>
                                        <th>Data</th>
                                        <th class="text-right">Quantidade</th>
                                        <th class="text-right">Preço</th>
                                        <th class="text-right">Total</th>
                                        <th class="text-center">Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Dados carregados dinamicamente -->
                                    <tr>
                                        <td><strong>BGIV25</strong><br><small class="text-muted">Boi Out/25</small></td>
                                        <td>
                                            <span class="badge badge-success">Compra</span><br>
                                            <small class="text-muted">Long</small>
                                        </td>
                                        <td>18/01/2025</td>
                                        <td class="text-right">
                                            5 contratos<br>
                                            <small class="text-muted">(1.650 arrobas)</small>
                                        </td>
                                        <td class="text-right">R$ 285,67<br><small class="text-muted">/arroba</small></td>
                                        <td class="text-right">R$ 471.355,50</td>
                                        <td class="text-center"><span class="badge badge-success">Executada</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>CCMH25</strong><br><small class="text-muted">Milho Mar/25</small></td>
                                        <td>
                                            <span class="badge badge-warning">Venda</span><br>
                                            <small class="text-muted">Short</small>
                                        </td>
                                        <td>17/01/2025</td>
                                        <td class="text-right">
                                            3 contratos<br>
                                            <small class="text-muted">(1.350 sacos)</small>
                                        </td>
                                        <td class="text-right">R$ 67,85<br><small class="text-muted">/saco</small></td>
                                        <td class="text-right">R$ 91.597,50</td>
                                        <td class="text-center"><span class="badge badge-success">Executada</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>BGIX25</strong><br><small class="text-muted">Boi Nov/25</small></td>
                                        <td>
                                            <span class="badge badge-success">Compra</span><br>
                                            <small class="text-muted">Long</small>
                                        </td>
                                        <td>16/01/2025</td>
                                        <td class="text-right">
                                            2 contratos<br>
                                            <small class="text-muted">(660 arrobas)</small>
                                        </td>
                                        <td class="text-right">R$ 287,23<br><small class="text-muted">/arroba</small></td>
                                        <td class="text-right">R$ 189.571,80</td>
                                        <td class="text-center"><span class="badge badge-success">Executada</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>CCMK25</strong><br><small class="text-muted">Milho Mai/25</small></td>
                                        <td>
                                            <span class="badge badge-success">Compra</span><br>
                                            <small class="text-muted">Long</small>
                                        </td>
                                        <td>15/01/2025</td>
                                        <td class="text-right">
                                            4 contratos<br>
                                            <small class="text-muted">(1.800 sacos)</small>
                                        </td>
                                        <td class="text-right">R$ 66,92<br><small class="text-muted">/saco</small></td>
                                        <td class="text-right">R$ 120.456,00</td>
                                        <td class="text-center"><span class="badge badge-success">Executada</span></td>
                                    </tr>
                                    <tr>
                                        <td><strong>BGIN25</strong><br><small class="text-muted">Boi Jul/25</small></td>
                                        <td>
                                            <span class="badge badge-warning">Venda</span><br>
                                            <small class="text-muted">Short</small>
                                        </td>
                                        <td>14/01/2025</td>
                                        <td class="text-right">
                                            1 contrato<br>
                                            <small class="text-muted">(330 arrobas)</small>
                                        </td>
                                        <td class="text-right">R$ 289,45<br><small class="text-muted">/arroba</small></td>
                                        <td class="text-right">R$ 95.518,50</td>
                                        <td class="text-center"><span class="badge badge-success">Executada</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Rentabilidade -->
            <div id="tab-rentabilidade" class="tab-content">
                <!-- Métricas de Performance -->
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Rentabilidade Total</div>
                            <div class="metric-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                        </div>
                        <div id="rentabilidade-total" class="metric-value">0%</div>
                        <div class="metric-change neutral">
                            <i class="fas fa-minus"></i>
                            <span>Período completo</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Fator de Lucro</div>
                            <div class="metric-icon">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                        </div>
                        <div id="fator-lucro" class="metric-value">0,00</div>
                        <div class="metric-change neutral">
                            <i class="fas fa-info-circle"></i>
                            <span>Lucro ÷ Prejuízo</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Volatilidade</div>
                            <div class="metric-icon">
                                <i class="fas fa-wave-square"></i>
                            </div>
                        </div>
                        <div id="volatilidade" class="metric-value">0%</div>
                        <div class="metric-change neutral">
                            <i class="fas fa-chart-area"></i>
                            <span>Desvio padrão</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Máximo Drawdown</div>
                            <div class="metric-icon">
                                <i class="fas fa-arrow-down"></i>
                            </div>
                        </div>
                        <div id="max-drawdown" class="metric-value">0%</div>
                        <div class="metric-change neutral">
                            <i class="fas fa-minus"></i>
                            <span>Maior queda</span>
                        </div>
                    </div>
                </div>

                <!-- Gráfico de Rentabilidade -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Curva de Rentabilidade</h3>
                        <p class="card-subtitle">Performance histórica dos seus investimentos</p>
                    </div>
                    <div class="card-body">
                        <div class="chart-container large">
                            <canvas id="chart-rentabilidade"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Distribuição de Resultados -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Distribuição por Referência</h3>
                        <p class="card-subtitle">Contribuição de cada contrato para o resultado</p>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="chart-distribuicao-referencias"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Treemap de Alocação -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Treemap de Alocação</h3>
                        <p class="card-subtitle">Visualização hierárquica da exposição por contrato</p>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <div id="treemap-container" class="treemap-container"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Posições -->
            <div id="tab-posicoes" class="tab-content">
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Posições Abertas</h3>
                        <p class="card-subtitle">Gerencie suas posições ativas</p>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="professional-table">
                                <thead>
                                    <tr>
                                        <th>Referência</th>
                                        <th>Tipo</th>
                                        <th class="text-center">Contratos</th>
                                        <th class="text-right">Preço Médio</th>
                                        <th class="text-right">Preço Atual</th>
                                        <th class="text-right">Resultado</th>
                                        <th class="text-center">Dias</th>
                                        <th class="text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="posicoes-abertas-tabela">
                                    <tr>
                                        <td colspan="8" class="text-center">Nenhuma posição aberta</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Posições Liquidadas</h3>
                        <p class="card-subtitle">Histórico de posições encerradas</p>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="professional-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Referência</th>
                                        <th>Tipo</th>
                                        <th class="text-center">Contratos</th>
                                        <th class="text-right">Preço Entrada</th>
                                        <th class="text-right">Preço Saída</th>
                                        <th class="text-right">Resultado</th>
                                        <th class="text-center">Dias</th>
                                    </tr>
                                </thead>
                                <tbody id="posicoes-liquidadas-tabela">
                                    <tr>
                                        <td colspan="8" class="text-center">Nenhuma posição liquidada</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Transações -->
            <div id="tab-transacoes" class="tab-content">
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">Histórico de Transações</h3>
                        <p class="card-subtitle">Todas as suas operações registradas</p>
                    </div>
                    <div class="card-actions">
                        <button class="btn btn-primary" onclick="abrirModal('modal-nova-transacao')">
                            <i class="fas fa-plus"></i>
                            Nova Transação
                        </button>
                        <button class="btn btn-secondary" onclick="exportarTransacoes()">
                            <i class="fas fa-file-excel"></i>
                            Exportar Excel
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table class="professional-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Referência</th>
                                        <th>Tipo</th>
                                        <th class="text-center">Contratos</th>
                                        <th class="text-right">Preço</th>
                                        <th class="text-right">Valor Total</th>
                                    </tr>
                                </thead>
                                <tbody id="transacoes-tabela">
                                    <tr>
                                        <td colspan="6" class="text-center">Nenhuma transação registrada</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba Configurações -->
            <div id="tab-configuracoes" class="tab-content">
                <!-- Preços Atuais -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-tag"></i>
                            Preços Atuais
                        </h3>
                        <p class="card-subtitle">Configure os preços atuais dos contratos para cálculos de resultado</p>
                    </div>
                    <div class="card-body">
                        <div id="precos-container" class="form-row">
                            <!-- Preenchido via JavaScript -->
                        </div>
                    </div>
                    <div class="card-actions">
                        <button id="btn-atualizar-precos" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Atualizar Preços
                        </button>
                    </div>
                </div>

                <!-- Tipos de Contrato -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-tags"></i> 
                            Tipos de Contrato e Referências
                        </h3>
                        <p class="card-subtitle">
                            Gerencie os tipos de contrato disponíveis (BGI, CCM, etc.) e suas referências específicas. 
                            As referências cadastradas aparecerão automaticamente no formulário de nova transação.
                        </p>
                    </div>
                    <div class="card-actions">
                        <button id="btn-novo-tipo-contrato" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Novo Tipo de Contrato
                        </button>
                        <button id="btn-nova-referencia" class="btn btn-secondary">
                            <i class="fas fa-plus-circle"></i> Nova Referência
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="tipos-contrato-container">
                            <!-- Será preenchido via JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Gerenciamento de Referências -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-edit"></i> 
                            Gerenciamento de Referências
                        </h3>
                        <p class="card-subtitle">
                            Personalize os nomes das referências, adicione novas ou remova referências existentes. 
                            Todas as alterações são salvas automaticamente.
                        </p>
                    </div>
                    <div class="card-actions">
                        <button id="btn-nova-referencia-personalizada" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Nova Referência
                        </button>
                        <button id="btn-resetar-nomes" class="btn btn-secondary">
                            <i class="fas fa-undo"></i> Resetar Nomes
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="referencias-manager-container">
                            <!-- Será preenchido via JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Armazenamento -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-database"></i>
                            Armazenamento Local
                        </h3>
                        <p class="card-subtitle">Gerencie seus dados armazenados localmente</p>
                    </div>
                    <div class="card-body">
                        <div class="storage-info">
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>Tamanho Total:</strong>
                                    <span id="storage-size">Calculando...</span>
                                </div>
                                <div class="info-item">
                                    <strong>Total de Transações:</strong>
                                    <span id="storage-transactions">-</span>
                                </div>
                                <div class="info-item">
                                    <strong>Último Salvamento:</strong>
                                    <span id="storage-last-saved">-</span>
                                </div>
                                <div class="info-item">
                                    <strong>Versão dos Dados:</strong>
                                    <span id="storage-version">-</span>
                                </div>
                                <div class="info-item">
                                    <strong>Backup Disponível:</strong>
                                    <span id="storage-backup">-</span>
                                </div>
                                <div class="info-item">
                                    <strong>Auto-Save:</strong>
                                    <span id="storage-autosave">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-actions">
                        <button id="btn-atualizar-storage-info" class="btn btn-secondary">
                            <i class="fas fa-refresh"></i> Atualizar Info
                        </button>
                        <button id="btn-criar-backup-manual" class="btn btn-primary">
                            <i class="fas fa-save"></i> Criar Backup
                        </button>
                        <button id="btn-restaurar-backup" class="btn btn-warning">
                            <i class="fas fa-undo"></i> Restaurar Backup
                        </button>
                        <button id="btn-limpar-storage" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Limpar Tudo
                        </button>
                    </div>
                </div>

                <!-- Exportar/Importar -->
                <div class="content-card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-exchange-alt"></i>
                            Exportar/Importar Dados
                        </h3>
                        <p class="card-subtitle">Faça backup ou restaure seus dados</p>
                    </div>
                    <div class="card-actions">
                        <button id="btn-exportar" class="btn btn-success">
                            <i class="fas fa-download"></i> Exportar Dados
                        </button>
                        <button id="btn-importar" class="btn btn-info">
                            <i class="fas fa-upload"></i> Importar Dados
                        </button>
                        <input type="file" id="file-import" accept=".json" style="display: none;">
                    </div>
                </div>
            </div>
        </main>
        </div> <!-- fim main-container -->
    </div>

    <!-- Modal Nova Transação -->
    <div class="modal" id="modal-nova-transacao">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Transação</h2>
                <button class="modal-close" onclick="fecharModal('modal-nova-transacao')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-nova-transacao">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="transacao-data">Data da Operação</label>
                            <input type="date" id="transacao-data" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="transacao-referencia">Referência do Contrato</label>
                            <select id="transacao-referencia" class="form-control" required>
                                <option value="">Selecionar referência...</option>
                                <!-- Preenchido via JavaScript -->
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label" for="transacao-tipo">Tipo de Operação</label>
                            <select id="transacao-tipo" class="form-control" required>
                                <option value="">Selecionar tipo...</option>
                                <option value="Compra">Compra (Long)</option>
                                <option value="Venda">Venda (Short)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="transacao-contratos">Quantidade de Contratos</label>
                            <input type="number" id="transacao-contratos" class="form-control" 
                                   min="1" step="1" placeholder="10" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="transacao-preco">Preço por Arroba (R$)</label>
                        <input type="number" id="transacao-preco" class="form-control" 
                               min="0" step="0.01" placeholder="290.50" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modal-nova-transacao')">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Salvar Transação
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal - Novo Tipo de Contrato -->
    <div class="modal" id="modal-novo-tipo-contrato">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Novo Tipo de Contrato</h2>
                <button class="modal-close" onclick="fecharModal('modal-novo-tipo-contrato')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-novo-tipo-contrato">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" for="tipo-codigo">Código:</label>
                        <input type="text" id="tipo-codigo" class="form-control" 
                               placeholder="Ex: BGI, CCM, SJC" 
                               pattern="[A-Z]{3}" 
                               maxlength="3" 
                               required>
                        <div class="form-help">3 letras maiúsculas</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="tipo-nome">Nome:</label>
                        <input type="text" id="tipo-nome" class="form-control" 
                               placeholder="Ex: Ativos, Milho, Soja" 
                               required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="tipo-descricao">Descrição:</label>
                        <input type="text" id="tipo-descricao" class="form-control" 
                               placeholder="Ex: Contratos futuros - B3">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="tipo-valor-arroba">Valor da Arroba (R$):</label>
                        <input type="number" id="tipo-valor-arroba" class="form-control" 
                               placeholder="330.00" 
                               step="0.01" 
                               min="0" 
                               required>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="tipo-ativo" checked>
                            <span class="checkmark"></span>
                            Tipo ativo (aparecer nas transações)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modal-novo-tipo-contrato')">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">Criar Tipo</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal - Nova Referência -->
    <div class="modal" id="modal-nova-referencia">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Referência</h2>
                <button class="modal-close" onclick="fecharModal('modal-nova-referencia')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-nova-referencia">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" for="referencia-tipo">Tipo de Contrato:</label>
                        <select id="referencia-tipo" class="form-control" required>
                            <option value="">Selecionar tipo...</option>
                            <!-- Preenchido via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="referencia-codigo">Código da Referência:</label>
                        <input type="text" id="referencia-codigo" class="form-control" 
                               placeholder="Ex: BGIJ25, CCMK25" 
                               pattern="[A-Z]{3}[A-Z]{1}[0-9]{2}" 
                               maxlength="6" 
                               required>
                        <div class="form-help">Formato: 3 letras tipo + 1 letra vencimento + 2 números ano</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="referencia-preco-inicial">Preço Inicial (R$):</label>
                        <input type="number" id="referencia-preco-inicial" class="form-control" 
                               placeholder="290.00" 
                               step="0.01" 
                               min="0">
                        <div class="form-help">Opcional - preço inicial para esta referência</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modal-nova-referencia')">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">Adicionar Referência</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal - Editar Tipo de Contrato -->
    <div class="modal" id="modal-editar-tipo-contrato">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Editar Tipo de Contrato</h2>
                <button class="modal-close" onclick="fecharModal('modal-editar-tipo-contrato')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-editar-tipo-contrato">
                <input type="hidden" id="edit-tipo-codigo-original">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" for="edit-tipo-codigo">Código:</label>
                        <input type="text" id="edit-tipo-codigo" class="form-control" readonly>
                        <div class="form-help">O código não pode ser alterado</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="edit-tipo-nome">Nome:</label>
                        <input type="text" id="edit-tipo-nome" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="edit-tipo-descricao">Descrição:</label>
                        <input type="text" id="edit-tipo-descricao" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="edit-tipo-valor-arroba">Valor da Arroba (R$):</label>
                        <input type="number" id="edit-tipo-valor-arroba" class="form-control" 
                               step="0.01" min="0" required>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-container">
                            <input type="checkbox" id="edit-tipo-ativo">
                            <span class="checkmark"></span>
                            Tipo ativo (aparecer nas transações)
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modal-editar-tipo-contrato')">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal - Nova Referência Personalizada -->
    <div class="modal" id="modal-nova-referencia-personalizada">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Nova Referência Personalizada</h2>
                <button class="modal-close" onclick="fecharModal('modal-nova-referencia-personalizada')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="form-nova-referencia-personalizada">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label" for="nova-ref-tipo">Tipo de Contrato:</label>
                        <select id="nova-ref-tipo" class="form-control" required>
                            <option value="">Selecionar tipo...</option>
                            <!-- Preenchido via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="nova-ref-codigo">Código da Referência:</label>
                        <input type="text" id="nova-ref-codigo" class="form-control" 
                               placeholder="Ex: BGIJ26, CCMK26" 
                               pattern="[A-Z]{3}[A-Z]{1}[0-9]{2}" 
                               maxlength="6" 
                               required>
                        <div class="form-help">Formato: 3 letras tipo + 1 letra vencimento + 2 números ano</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="nova-ref-nome">Nome Personalizado:</label>
                        <input type="text" id="nova-ref-nome" class="form-control" 
                               placeholder="Ex: Boi Jan/26, Milho Mai/26" 
                               required>
                        <div class="form-help">Nome amigável para exibir nos formulários</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="nova-ref-preco">Preço Inicial (R$):</label>
                        <input type="number" id="nova-ref-preco" class="form-control" 
                               placeholder="290.00" 
                               step="0.01" 
                               min="0">
                        <div class="form-help">Opcional - preço inicial para esta referência</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modal-nova-referencia-personalizada')">
                        Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Criar Referência
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage-manager.js?v=inter-compacto-icones-corrigidos-20250119"></script>
    <script src="js/charts.js?v=inter-compacto-icones-corrigidos-20250119"></script>
    <script src="js/app.js?v=inter-compacto-icones-corrigidos-20250119"></script>
</body>
</html>

