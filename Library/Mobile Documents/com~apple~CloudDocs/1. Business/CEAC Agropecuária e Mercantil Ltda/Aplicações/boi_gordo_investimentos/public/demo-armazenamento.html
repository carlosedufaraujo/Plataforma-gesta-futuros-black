<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üíæ Demo Armazenamento Local - Boi Gordo</title>
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body { margin: 20px; font-family: Arial, sans-serif; background: #f5f5f5; }
        .demo-container { max-width: 1200px; margin: 0 auto; }
        .demo-section { 
            background: white; 
            margin: 20px 0; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .demo-header { 
            text-align: center; 
            color: #2c3e50; 
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        .demo-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
            gap: 20px; 
            margin: 20px 0;
        }
        .status-box { 
            background: #f8f9fa; 
            padding: 20px; 
            border-radius: 8px; 
            border-left: 4px solid #007bff;
            margin: 15px 0;
        }
        .status-box h3 { margin-top: 0; color: #495057; }
        .status-box code { 
            background: #e9ecef; 
            padding: 2px 6px; 
            border-radius: 3px; 
            font-family: 'Courier New', monospace;
        }
        .btn-demo { 
            display: inline-block;
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-demo:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        
        .console-output { 
            background: #000; 
            color: #0f0; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            max-height: 300px; 
            overflow-y: auto; 
            margin: 20px 0;
        }
        
        .feature-list { 
            list-style: none; 
            padding: 0;
        }
        .feature-list li { 
            padding: 8px 0; 
            padding-left: 30px; 
            position: relative;
        }
        .feature-list li:before { 
            content: "‚úÖ"; 
            position: absolute; 
            left: 0; 
            top: 8px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #495057;
            display: block;
        }
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üíæ Sistema Avan√ßado de Armazenamento Local</h1>
            <p>Demonstra√ß√£o completa das funcionalidades de persist√™ncia de dados</p>
        </div>

        <!-- Status do Sistema -->
        <div class="demo-section">
            <h2>üìä Status do Sistema</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <span id="stat-storage-size" class="stat-value">-</span>
                    <div class="stat-label">Tamanho Total</div>
                </div>
                <div class="stat-card">
                    <span id="stat-transactions" class="stat-value">-</span>
                    <div class="stat-label">Transa√ß√µes</div>
                </div>
                <div class="stat-card">
                    <span id="stat-positions" class="stat-value">-</span>
                    <div class="stat-label">Posi√ß√µes</div>
                </div>
                <div class="stat-card">
                    <span id="stat-backups" class="stat-value">-</span>
                    <div class="stat-label">Backups</div>
                </div>
                <div class="stat-card">
                    <span id="stat-version" class="stat-value">-</span>
                    <div class="stat-label">Vers√£o</div>
                </div>
                <div class="stat-card">
                    <span id="stat-last-saved" class="stat-value">-</span>
                    <div class="stat-label">√öltimo Save</div>
                </div>
            </div>

            <div style="text-align: center; margin: 20px 0;">
                <button class="btn-demo btn-primary" onclick="atualizarStatusCompleto()">
                    üîÑ Atualizar Status
                </button>
            </div>
        </div>

        <!-- Funcionalidades -->
        <div class="demo-section">
            <h2>üöÄ Funcionalidades Dispon√≠veis</h2>
            
            <div class="demo-grid">
                <div>
                    <h3>üíæ Gest√£o B√°sica</h3>
                    <ul class="feature-list">
                        <li>Salvamento autom√°tico a cada 30s</li>
                        <li>Salvamento antes de fechar p√°gina</li>
                        <li>Valida√ß√£o de dados</li>
                        <li>Recupera√ß√£o de erros</li>
                        <li>Versionamento autom√°tico</li>
                    </ul>
                </div>
                
                <div>
                    <h3>üîÑ Backup & Restore</h3>
                    <ul class="feature-list">
                        <li>Backup autom√°tico antes de salvar</li>
                        <li>Cria√ß√£o manual de backups</li>
                        <li>Restaura√ß√£o de backups</li>
                        <li>Hist√≥rico de opera√ß√µes</li>
                        <li>Recupera√ß√£o de dados corrompidos</li>
                    </ul>
                </div>
                
                <div>
                    <h3>üì§ Import/Export</h3>
                    <ul class="feature-list">
                        <li>Exporta√ß√£o para arquivo JSON</li>
                        <li>Importa√ß√£o de dados</li>
                        <li>Valida√ß√£o de estrutura</li>
                        <li>Backup antes de importar</li>
                        <li>Metadados de exporta√ß√£o</li>
                    </ul>
                </div>
                
                <div>
                    <h3>üîß Otimiza√ß√£o</h3>
                    <ul class="feature-list">
                        <li>Limpeza de dados antigos</li>
                        <li>Otimiza√ß√£o de armazenamento</li>
                        <li>Compress√£o autom√°tica</li>
                        <li>An√°lise de uso de espa√ßo</li>
                        <li>Relat√≥rios de performance</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Teste de Opera√ß√µes -->
        <div class="demo-section">
            <h2>üß™ Teste de Opera√ß√µes</h2>
            
            <div class="demo-grid">
                <!-- Opera√ß√µes B√°sicas -->
                <div>
                    <h3>Opera√ß√µes B√°sicas</h3>
                    <button class="btn-demo btn-success" onclick="criarDadosTeste()">
                        ‚ûï Criar Dados de Teste
                    </button>
                    <button class="btn-demo btn-primary" onclick="salvarDadosManual()">
                        üíæ Salvar Dados
                    </button>
                    <button class="btn-demo btn-info" onclick="carregarDadosManual()">
                        üì• Carregar Dados
                    </button>
                </div>
                
                <!-- Backup -->
                <div>
                    <h3>Backup & Restore</h3>
                    <button class="btn-demo btn-primary" onclick="criarBackupManual()">
                        üì¶ Criar Backup
                    </button>
                    <button class="btn-demo btn-warning" onclick="restaurarBackupManual()">
                        üîÑ Restaurar Backup
                    </button>
                </div>
                
                <!-- Export/Import -->
                <div>
                    <h3>Export & Import</h3>
                    <button class="btn-demo btn-success" onclick="exportarDadosDemo()">
                        üì§ Exportar Dados
                    </button>
                    <button class="btn-demo btn-info" onclick="importarDadosDemo()">
                        üì• Importar Dados
                    </button>
                </div>
                
                <!-- Manuten√ß√£o -->
                <div>
                    <h3>Manuten√ß√£o</h3>
                    <button class="btn-demo btn-info" onclick="otimizarArmazenamentoDemo()">
                        üîß Otimizar Storage
                    </button>
                    <button class="btn-demo btn-danger" onclick="limparTudoDemo()">
                        üóëÔ∏è Limpar Tudo
                    </button>
                </div>
            </div>
        </div>

        <!-- Console de Logs -->
        <div class="demo-section">
            <h2>üìã Console de Logs</h2>
            <div class="console-output" id="console-logs"></div>
            <div style="text-align: center; margin: 15px 0;">
                <button class="btn-demo btn-primary" onclick="limparLogs()">
                    üßπ Limpar Logs
                </button>
                <button class="btn-demo btn-info" onclick="mostrarEstatisticasDetalhadas()">
                    üìä Estat√≠sticas Detalhadas
                </button>
            </div>
        </div>

        <!-- Informa√ß√µes T√©cnicas -->
        <div class="demo-section">
            <h2>üîß Informa√ß√µes T√©cnicas</h2>
            <div id="info-tecnica" class="status-box">
                <h3>Capacidades do Sistema:</h3>
                <p><code>localStorage</code> dispon√≠vel: <span id="localstorage-available">-</span></p>
                <p>Quota aproximada: <span id="storage-quota">-</span></p>
                <p>Espa√ßo usado: <span id="storage-used">-</span></p>
                <p>Espa√ßo dispon√≠vel: <span id="storage-available">-</span></p>
                <p>Suporte JSON: <span id="json-support">-</span></p>
                <p>Compress√£o: <span id="compression-support">-</span></p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="data_api.js"></script>
    <script src="js/storage-manager.js"></script>
    <script src="js/app.js"></script>

    <script>
        let logMessages = [];
        
        // Interceptar logs do StorageManager
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('[Storage]') || message.includes('[BoiGordo]')) {
                adicionarLog(message);
            }
            originalConsoleLog.apply(console, args);
        };
        
        function adicionarLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            logMessages.push(`[${timestamp}] ${message}`);
            
            // Manter apenas √∫ltimas 50 mensagens
            if (logMessages.length > 50) {
                logMessages = logMessages.slice(-50);
            }
            
            atualizarConsole();
        }
        
        function atualizarConsole() {
            const console = document.getElementById('console-logs');
            if (console) {
                console.innerHTML = logMessages.join('\n');
                console.scrollTop = console.scrollHeight;
            }
        }
        
        function limparLogs() {
            logMessages = [];
            atualizarConsole();
        }
        
        // Atualizar status
        function atualizarStatusCompleto() {
            adicionarLog('üîÑ Atualizando status completo...');
            
            if (window.StorageManager) {
                const status = window.StorageManager.getStatusArmazenamento();
                
                document.getElementById('stat-storage-size').textContent = status.tamanhoFormatado || 'N/A';
                document.getElementById('stat-transactions').textContent = status.totalTransacoes.toString();
                document.getElementById('stat-positions').textContent = status.totalPosicoes || '0';
                document.getElementById('stat-backups').textContent = status.temBackup ? '1' : '0';
                document.getElementById('stat-version').textContent = status.versao || 'N/A';
                document.getElementById('stat-last-saved').textContent = status.ultimoSalvamento ? 
                    new Date(status.ultimoSalvamento).toLocaleString('pt-BR') : 'Nunca';
                
                adicionarLog('‚úÖ Status atualizado com sucesso');
            } else {
                adicionarLog('‚ùå StorageManager n√£o dispon√≠vel');
            }
            
            // Atualizar informa√ß√µes t√©cnicas
            atualizarInfoTecnica();
        }
        
        function atualizarInfoTecnica() {
            document.getElementById('localstorage-available').textContent = 
                typeof(Storage) !== "undefined" ? 'Sim ‚úÖ' : 'N√£o ‚ùå';
                
            document.getElementById('json-support').textContent = 
                typeof JSON !== 'undefined' ? 'Sim ‚úÖ' : 'N√£o ‚ùå';
                
            document.getElementById('compression-support').textContent = 'N√£o implementado';
            
            // Tentar estimar quota
            if (navigator.storage && navigator.storage.estimate) {
                navigator.storage.estimate().then(estimate => {
                    document.getElementById('storage-quota').textContent = 
                        formatarBytes(estimate.quota || 0);
                    document.getElementById('storage-used').textContent = 
                        formatarBytes(estimate.usage || 0);
                    document.getElementById('storage-available').textContent = 
                        formatarBytes((estimate.quota || 0) - (estimate.usage || 0));
                });
            } else {
                document.getElementById('storage-quota').textContent = 'N√£o dispon√≠vel';
                document.getElementById('storage-used').textContent = 'N√£o dispon√≠vel';
                document.getElementById('storage-available').textContent = 'N√£o dispon√≠vel';
            }
        }
        
        function formatarBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Opera√ß√µes de teste
        function criarDadosTeste() {
            adicionarLog('üß™ Criando dados de teste...');
            
            if (window.AppState && window.StorageManager) {
                // Adicionar transa√ß√µes de teste
                const transacoesTeste = [
                    {
                        id: 'test_' + Date.now() + '_1',
                        data: new Date().toISOString().split('T')[0],
                        referencia: 'BGIJ25',
                        tipo: 'Compra',
                        contratos: 10,
                        preco: 290.50,
                        criadoEm: new Date().toISOString()
                    },
                    {
                        id: 'test_' + Date.now() + '_2',
                        data: new Date().toISOString().split('T')[0],
                        referencia: 'BGIK25',
                        tipo: 'Venda',
                        contratos: 5,
                        preco: 292.75,
                        criadoEm: new Date().toISOString()
                    }
                ];
                
                transacoesTeste.forEach(transacao => {
                    window.StorageManager.salvarTransacao(transacao);
                });
                
                adicionarLog(`‚úÖ Criadas ${transacoesTeste.length} transa√ß√µes de teste`);
                atualizarStatusCompleto();
            } else {
                adicionarLog('‚ùå Sistema n√£o dispon√≠vel para criar dados de teste');
            }
        }
        
        function salvarDadosManual() {
            adicionarLog('üíæ Salvando dados manualmente...');
            
            if (window.StorageManager && window.AppState) {
                const sucesso = window.StorageManager.salvarDados(window.AppState.data);
                if (sucesso) {
                    adicionarLog('‚úÖ Dados salvos com sucesso');
                    atualizarStatusCompleto();
                } else {
                    adicionarLog('‚ùå Erro ao salvar dados');
                }
            }
        }
        
        function carregarDadosManual() {
            adicionarLog('üì• Carregando dados manualmente...');
            
            if (window.StorageManager) {
                const dados = window.StorageManager.carregarDados();
                adicionarLog(`‚úÖ Dados carregados: ${dados.transacoes?.length || 0} transa√ß√µes`);
                atualizarStatusCompleto();
            }
        }
        
        function criarBackupManual() {
            adicionarLog('üì¶ Criando backup manual...');
            
            if (window.StorageManager) {
                const sucesso = window.StorageManager.criarBackup();
                if (sucesso) {
                    adicionarLog('‚úÖ Backup criado com sucesso');
                } else {
                    adicionarLog('‚ùå Erro ao criar backup');
                }
                atualizarStatusCompleto();
            }
        }
        
        function restaurarBackupManual() {
            adicionarLog('üîÑ Restaurando backup...');
            
            if (confirm('Deseja restaurar o backup? Os dados atuais ser√£o sobrescritos.')) {
                if (window.StorageManager) {
                    const backup = window.StorageManager.recuperarBackup();
                    if (backup) {
                        window.StorageManager.salvarDados(backup);
                        adicionarLog('‚úÖ Backup restaurado com sucesso');
                        atualizarStatusCompleto();
                    } else {
                        adicionarLog('‚ùå Nenhum backup encontrado');
                    }
                }
            }
        }
        
        function exportarDadosDemo() {
            adicionarLog('üì§ Exportando dados...');
            
            if (window.StorageManager) {
                const sucesso = window.StorageManager.exportarDados();
                if (sucesso) {
                    adicionarLog('‚úÖ Dados exportados com sucesso');
                } else {
                    adicionarLog('‚ùå Erro ao exportar dados');
                }
            }
        }
        
        function importarDadosDemo() {
            adicionarLog('üì• Selecionando arquivo para importar...');
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.addEventListener('change', async function(e) {
                const arquivo = e.target.files[0];
                if (arquivo) {
                    try {
                        adicionarLog(`üìÇ Importando arquivo: ${arquivo.name}`);
                        
                        if (window.StorageManager) {
                            await window.StorageManager.importarDados(arquivo);
                            adicionarLog('‚úÖ Dados importados com sucesso');
                            atualizarStatusCompleto();
                        }
                    } catch (error) {
                        adicionarLog('‚ùå Erro ao importar: ' + error.message);
                    }
                }
            });
            input.click();
        }
        
        function otimizarArmazenamentoDemo() {
            adicionarLog('üîß Otimizando armazenamento...');
            
            if (window.StorageManager) {
                const sucesso = window.StorageManager.otimizarArmazenamento();
                if (sucesso) {
                    adicionarLog('‚úÖ Armazenamento otimizado');
                } else {
                    adicionarLog('‚ùå Erro ao otimizar');
                }
                atualizarStatusCompleto();
            }
        }
        
        function limparTudoDemo() {
            if (confirm('ATEN√á√ÉO: Todos os dados ser√£o apagados!\nDeseja continuar?')) {
                if (confirm('√öltima confirma√ß√£o: Esta a√ß√£o n√£o pode ser desfeita!')) {
                    adicionarLog('üóëÔ∏è Limpando todos os dados...');
                    
                    if (window.StorageManager) {
                        const sucesso = window.StorageManager.limparTodosDados();
                        if (sucesso) {
                            adicionarLog('‚úÖ Todos os dados foram limpos');
                        } else {
                            adicionarLog('‚ùå Erro ao limpar dados');
                        }
                        atualizarStatusCompleto();
                    }
                }
            }
        }
        
        function mostrarEstatisticasDetalhadas() {
            adicionarLog('üìä Gerando estat√≠sticas detalhadas...');
            
            if (window.StorageManager) {
                const status = window.StorageManager.getStatusArmazenamento();
                
                adicionarLog('‚ïê‚ïê‚ïê ESTAT√çSTICAS DETALHADAS ‚ïê‚ïê‚ïê');
                adicionarLog(`üìä Tamanho total: ${status.tamanhoFormatado}`);
                adicionarLog(`üìà Total transa√ß√µes: ${status.totalTransacoes}`);
                adicionarLog(`üìÖ √öltima atualiza√ß√£o: ${status.ultimoSalvamento || 'N/A'}`);
                adicionarLog(`üî¢ Vers√£o: ${status.versao}`);
                adicionarLog(`üíæ Backup dispon√≠vel: ${status.temBackup ? 'Sim' : 'N√£o'}`);
                adicionarLog('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            }
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            adicionarLog('üöÄ Sistema de demonstra√ß√£o inicializado');
            
            // Aguardar carregamento completo
            setTimeout(() => {
                atualizarStatusCompleto();
                adicionarLog('‚úÖ Demo pronto para uso');
            }, 1000);
        });
        
        // Capturar erros
        window.addEventListener('error', function(e) {
            adicionarLog(`‚ùå ERRO: ${e.message} (${e.filename}:${e.lineno})`);
        });
    </script>
</body>
</html> 